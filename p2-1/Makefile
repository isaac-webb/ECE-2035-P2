#   make [test] - builds everything, and runs the tests
#   make build  - just builds everything
#   make TARGET - makes the given target.
#   make clean  - removes all files generated by make.

# Project settings. Change these to match your files
DLL_IMPL = doublely_linked_list
DLL_TEST = dll_tests
CXXFLAGS += -g -Wall -Wextra -pthread

# Primary build targets.
test : build
	./$(DLL_TEST)

build: $(DLL_TEST)

clean :
	rm -f gtest_main.a *.o $(DLL_TEST)

# Targets for building the linked list test suite
$(DLL_IMPL).o : $(DLL_IMPL).cpp $(DLL_IMPL).h $(GTEST_HEADERS)
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c $(DLL_IMPL).cpp

$(DLL_TEST).o : $(DLL_TEST).cpp $(DLL_IMPL).h $(GTEST_HEADERS)
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c $(DLL_TEST).cpp

$(DLL_TEST) : $(DLL_IMPL).o $(DLL_TEST).o gtest_main.a
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -lpthread $^ -o $@

# Google test framework settings. Don't mess with these!
GTEST_DIR = gtest
GTEST_HEADERS = $(GTEST_DIR)/include/gtest/*.h \
                $(GTEST_DIR)/include/gtest/internal/*.h
GTEST_SRCS_ = $(GTEST_DIR)/src/*.h $(GTEST_HEADERS)
CPPFLAGS += -isystem $(GTEST_DIR)/include

# Targets for building Google Test framework
gtest-all.o : $(GTEST_SRCS_)
	$(CXX) $(CPPFLAGS) -I$(GTEST_DIR) $(CXXFLAGS) -c \
            $(GTEST_DIR)/src/gtest-all.cc

gtest_main.o : $(GTEST_SRCS_)
	$(CXX) $(CPPFLAGS) -I$(GTEST_DIR) $(CXXFLAGS) -c \
            $(GTEST_DIR)/src/gtest_main.cc

gtest_main.a : gtest-all.o gtest_main.o
	$(AR) $(ARFLAGS) $@ $^
